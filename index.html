<head>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
</head>
<body>
<section id=main>
<button onclick=makeProject()>Make a project</button> <button onclick="openProject(prompt('Please provide the project ID...'))">Open project</button>
</section>
<section id=edit>

</section>
</body>
<script>
const firebaseConfig = {
apiKey: "AIzaSyCSj-08ucArB3oiYNDq2iAriYadYOiJ27U",
authDomain: "host-5397f.firebaseapp.com",
databaseURL: "https://host-5397f-default-rtdb.firebaseio.com",
projectId: "host-5397f",
storageBucket: "host-5397f.firebasestorage.app",
messagingSenderId: "94637520547",
appId: "1:94637520547:web:f84c856857aafb772cb116",
measurementId: "G-3D4J5FJ5T1"
}
firebase.initializeApp(firebaseConfig)
firebase.analytics()
shown("edit", false)
const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
let currentID = ""
function generateId(lengths) {
const id = lengths.map(function(len) {
let part = ""
for (let i=0; i<len; i++) {
part += charset.charAt(Math.floor(Math.random() * charset.length))
}
return part
}).join("-")
currentID = id 
return id
}
function lookForProject(id) {
firebase.database().ref("projects/" + id).once("value", function(snapshot) {
if (snapshot.exists()) {
console.log("Project exists:", id)
} else {
console.log("Project does not exist:", id)
}
})
}
function generateUniqueId() {
let intervals = 3
function tryNext() {
const lengths = Array(intervals).fill(4) 
const id = generateId(lengths)
firebase.database().ref("projects/" + id).once("value", function(snapshot) {
if (!snapshot.exists()) {
currentID = id
console.log("Unique ID generated:", id)
} else {
intervals++
tryNext()
}
})
}
tryNext()
}
function makeProject() {
let interval = 4
function tryNext() {
let lengths = Array(interval).fill(interval)
let id = lengths.map(function(len) {
let part = ""
for (let i = 0; i < len; i++) {
part += charset.charAt(Math.floor(Math.random() * charset.length))
}
return part
}).join("-")
firebase.database().ref("projects/" + id).once("value", function(snapshot) {
if (!snapshot.exists()) {
currentID = id
firebase.database().ref("projects/" + currentID).set({ created: Date.now().toString() }, function(error) {
if (!error) {
alert(`Make sure to screenshot, take a photo, or copy & paste this ID somewhere to keep it saved! You'll need this ID to edit your project and get the public URL to your project...

${currentID}`)
copy(currentID)
openProject(currentID)
} else {
alert("Error saving project. Please try again.")
}
})
} else {
interval++
tryNext()
}
})
}
tryNext()
}
function deleteProject(id) {
firebase.database().ref("projects/" + id).once("value", function(snapshot) {
if (snapshot.exists()) {
firebase.database().ref("projects/" + id).remove()
}
})
}
function saveDetail(id, dname, dval) {
firebase.database().ref("projects/" + id + "/" + dname).set(dval)
}
function getDetail(id, dname) {
firebase.database().ref("projects/" + id + "/" + dname).once("value", function(snapshot) {
if (snapshot.exists()) {
console.log("Value:", snapshot.val())
} else {
console.log("No value found")
}
})
}
function copy(text) {
navigator.clipboard.writeText(text)
}
function shown(id, tf) {
if (tf) {
document.getElementById(id).style.display = ""
} else {
document.getElementById(id).style.display = "none"
}
}
function openProject(id) {
firebase.database().ref("projects/" + id).once("value", function(snapshot) {
if (snapshot.exists()) {
shown("main", false)
shown("edit", true)
} else {
alert("Project not found!")
}
})
}
</script>
